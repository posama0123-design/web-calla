<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€å¼·ã‚¬ãƒ©ã‚±ãƒ¼é€šè©±æ©Ÿ</title>
    <style>
        body { background: #333; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; font-family: "MS Gothic", "Courier New", monospace; color: #000; overflow: hidden; }
        .phone { width: 300px; background: #c0c0c0; border: 4px solid #888; border-radius: 20px; padding: 20px; box-shadow: 10px 10px 0 #000; }
        .screen { background: #9dbb16; border: 5px solid #222; height: 240px; padding: 10px; position: relative; font-weight: bold; display: flex; flex-direction: column; }
        
        .battery { position: absolute; top: 5px; right: 5px; border: 2px solid #000; width: 25px; height: 10px; display: flex; align-items: center; }
        .battery::after { content: ""; background: #000; width: 6px; height: 80%; margin-left: 2px; }
        
        .status-bar { font-size: 12px; border-bottom: 2px solid #000; padding-bottom: 3px; margin-bottom: 5px; display: flex; justify-content: space-between; }
        .display-area { flex-grow: 1; text-align: center; display: flex; flex-direction: column; justify-content: center; }
        
        .sms-panel { border: 1px dashed #000; font-size: 11px; padding: 3px; margin-top: 5px; background: rgba(0,0,0,0.05); text-align: left; }
        
        input { width: 100%; background: transparent; border: none; font-size: 24px; text-align: center; outline: none; font-family: inherit; margin: 10px 0; }
        
        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 15px; }
        .key { background: #eee; border: 2px solid #444; border-radius: 5px; padding: 10px; text-align: center; box-shadow: 2px 2px 0 #444; font-size: 14px; color: #000; font-weight: bold; }
        
        /* ãƒœã‚¿ãƒ³è‰²åˆ†ã‘ */
        .call-btn { background: #2ecc71; color: white; } /* é€šè©±ã«å‡ºã‚‹ */
        .end-btn { background: #e74c3c; color: white; }  /* åˆ‡ã‚‹ */
        .mail-btn { background: #f1c40f; }             /* ãƒ¡ãƒ¼ãƒ« */
        
        .info { font-size: 9px; margin-top: 5px; color: #444; }
    </style>
</head>
<body>

<div class="phone">
    <div class="screen">
        <div class="status-bar">
            <div id="status">ğŸ“¶åœå¤–</div>
            <div class="battery"></div>
        </div>

        <div class="display-area" id="screen-content">
            <div style="font-size: 10px;">ID: <span id="my-id">--</span></div>
            <input type="text" id="phone-number" placeholder="ç•ªå·å…¥åŠ›" readonly>
            <div id="call-state" style="font-size: 18px; display:none;">é€šè©±ä¸­... <span id="timer">00:00</span></div>
            
            <div class="sms-panel">
                ã€æ–°ç€ï¾’ï½°ï¾™ã€‘
                <div id="sms-display">ãªã—</div>
            </div>
        </div>
        <div class="info">â†â†’ã§ï¾’ï½°ï¾™/é›»è©±åˆ‡æ›¿ â€»PCçŸ¢å°ï½·ï½°å¯¾å¿œ</div>
    </div>

    <div class="keypad">
        <div class="key">1</div><div class="key">2</div><div class="key">3</div>
        <div class="key">4</div><div class="key">5</div><div class="key">6</div>
        <div class="key">7</div><div class="key">8</div><div class="key">9</div>
        <button class="key mail-btn" id="btn-mail">âœ‰</button><div class="key">0</div><div class="key">#</div>
        <button class="key call-btn" id="btn-call">ğŸ“é€šè©±</button>
        <div class="key">æ±ºå®š</div>
        <button class="key end-btn" id="btn-end">ğŸ“´åˆ‡æ–­</button>
    </div>
</div>

<audio id="remote-audio" autoplay></audio>

<script src="https://cdn.jsdelivr.net/npm/@skyway-sdk/room/dist/skyway_room.js"></script>
<script>
    const { SkyWayContext, SkyWayRoom, SkyWayStreamFactory } = SkyWayRoom;
    const API_KEY = '1bb9fbdb-aa26-4350-a40e-7cc6429e1838';
    let localStream, room, me, context;

    // --- PCã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ ---
    window.addEventListener('keydown', (e) => {
        const input = document.getElementById('phone-number');
        if (e.key >= '0' && e.key <= '9') input.value += e.key;
        if (e.key === 'Backspace') input.value = input.value.slice(0, -1);
        if (e.key === 'Enter') startCall();      // Enterã§é€šè©±
        if (e.key === 'Escape') location.reload(); // Escã§åˆ‡æ–­
        if (e.key === 'ArrowRight') document.getElementById('sms-display').innerText = "ï¾’ï½°ï¾™ç”»é¢ã¸åˆ‡æ›¿..."; 
    });

    async function setup() {
        document.getElementById('my-id').innerText = Math.floor(Math.random() * 1000);
        try {
            localStream = await SkyWayStreamFactory.createMicrophoneAudioStream();
            document.getElementById('status').innerText = "ğŸ“¶æº–å‚™å®Œäº†";
        } catch (e) {
            document.getElementById('status').innerText = "âš ï¸ï¾ï½²ï½¸è¨±å¯!";
        }
    }

    async function startCall() {
        const num = document.getElementById('phone-number').value;
        if (!num) return alert("ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

        document.getElementById('status').innerText = "â˜æ¥ç¶šä¸­...";
        context = await SkyWayContext.Create(API_KEY, { auth: { type: 'none' } });
        room = await SkyWayRoom.FindOrCreate(context, { type: 'p2p', name: num });
        me = await room.join();
        await me.publish(localStream);

        room.onStreamPublished.add(async ({ stream }) => {
            if (stream.contentType === 'audio') {
                const { track } = await me.subscribe(stream.id);
                track.attach(document.getElementById('remote-audio'));
                
                // é€šè©±ä¸­UI
                document.getElementById('status').innerText = "ğŸ“¶é€šè©±ä¸­";
                document.getElementById('phone-number').style.display = 'none';
                document.getElementById('call-state').style.display = 'block';
                startTimer();
            }
        });
    }

    // å„ãƒœã‚¿ãƒ³ã®å‹•ä½œ
    document.getElementById('btn-call').onclick = startCall;
    document.getElementById('btn-end').onclick = () => location.reload();
    document.getElementById('btn-mail').onclick = () => {
        const msg = prompt("é€ã‚ŠãŸã„æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        if(msg) document.getElementById('sms-display').innerText = "é€ä¿¡æ¸ˆ: " + msg;
    };

    function startTimer() {
        let sec = 0;
        setInterval(() => {
            sec++;
            let m = Math.floor(sec / 60).toString().padStart(2, '0');
            let s = (sec % 60).toString().padStart(2, '0');
            document.getElementById('timer').innerText = `${m}:${s}`;
        }, 1000);
    }

    setup();
</script>
</body>
</html>
