<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¬ãƒ©ã‚±ãƒ¼é€šè©±ï¼†ãƒ¡ãƒ¼ãƒ«</title>
    <style>
        body { background: #333; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; font-family: "MS Gothic", "Courier New", monospace; overflow: hidden; }
        .phone { width: 280px; background: #c0c0c0; border: 4px solid #888; border-radius: 20px; padding: 20px; box-shadow: 10px 10px 0 #000; position: relative; }
        .screen { background: #9dbb16; border: 5px solid #222; height: 200px; padding: 10px; color: #000; overflow-y: auto; position: relative; font-weight: bold; }
        
        /* ãƒãƒƒãƒ†ãƒªãƒ¼æ£’1æœ¬ */
        .battery { position: absolute; top: 5px; right: 5px; border: 2px solid #000; width: 25px; height: 10px; display: flex; align-items: center; }
        .battery::after { content: ""; background: #000; width: 6px; height: 80%; margin-left: 2px; }
        
        .status-text { font-size: 14px; border-bottom: 2px solid #000; padding-bottom: 5px; margin-bottom: 5px; }
        .id-display { font-size: 20px; text-align: center; }
        input { width: 90%; background: transparent; border: none; border-bottom: 2px solid #000; font-size: 20px; text-align: center; outline: none; font-family: inherit; color: #000; }
        
        .buttons { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 15px; }
        .key { background: #eee; border: 2px solid #444; border-radius: 5px; padding: 10px; text-align: center; box-shadow: 2px 2px 0 #444; cursor: pointer; color: #000; font-size: 16px; user-select: none; }
        .key:active { transform: translate(1px, 1px); box-shadow: none; background: #ddd; }
        
        .call-btn { background: #008000; color: white; grid-column: span 1; font-weight: bold; }
        .mail-btn { background: #ffcc00; color: #000; grid-column: span 1; font-weight: bold; }
        .end-btn { background: #ff0000; color: white; grid-column: span 1; font-weight: bold; }
        
        /* SMSç”»é¢ç”¨ */
        #sms-view { display: none; font-size: 12px; }
        .msg-log { height: 80px; border: 1px solid #000; margin-top: 5px; overflow-y: auto; padding: 2px; background: rgba(0,0,0,0.05); }
    </style>
</head>
<body>

<div class="phone">
    <div class="screen" id="main-screen">
        <div class="battery"></div>
        <div class="status-text" id="status">ğŸ“¶ åœå¤–</div>
        
        <div id="home-ui">
            <div style="font-size: 10px;">MY ID: <span id="my-id">--</span></div>
            <div class="id-display" style="margin-top:20px;">
                <input type="text" id="room-name" placeholder="åˆè¨€è‘‰" readonly>
            </div>
            <div style="font-size: 10px; text-align: center; margin-top: 10px;">åˆè¨€è‘‰ã‚’å…¥ã‚Œã¦ç™ºä¿¡</div>
        </div>

        <div id="calling-ui" style="display:none; text-align:center;">
            <div style="font-size: 18px; margin-top: 20px;">é€šè©±ä¸­</div>
            <div id="timer" style="font-size: 24px;">00:00</div>
        </div>

        <div id="sms-view">
            <div>âœ‰ ï¾’ï½°ï¾™é€ä¿¡</div>
            <input type="text" id="sms-input" placeholder="æœ¬æ–‡" style="font-size: 14px; border-bottom: 1px solid #000;">
            <div class="msg-log" id="msg-log">å—ä¿¡ï¾’ï½°ï¾™ãªã—</div>
            <div style="font-size: 9px; margin-top: 5px;">*ã‚­ãƒ¼ã§é€ä¿¡</div>
        </div>
    </div>

    <div class="buttons">
        <div class="key" onclick="pressKey('1')">1</div><div class="key" onclick="pressKey('2')">2</div><div class="key" onclick="pressKey('3')">3</div>
        <div class="key" onclick="pressKey('4')">4</div><div class="key" onclick="pressKey('5')">5</div><div class="key" onclick="pressKey('6')">6</div>
        <div class="key" onclick="pressKey('7')">7</div><div class="key" onclick="pressKey('8')">8</div><div class="key" onclick="pressKey('9')">9</div>
        <div class="key" onclick="pressKey('*')">*</div><div class="key" onclick="pressKey('0')">0</div><div class="key" onclick="pressKey('#')">#</div>
        
        <button id="make-call" class="key call-btn">é€šè©±</button>
        <button id="toggle-sms" class="key mail-btn" onclick="toggleSMS()">ï¾’ï½°ï¾™</button>
        <button id="end-call" class="key end-btn" onclick="location.reload()">é›»æº</button>
    </div>
</div>

<audio id="remote-audio" autoplay></audio>

<script src="https://cdn.jsdelivr.net/npm/@skyway-sdk/room/dist/skyway_room.js"></script>
<script>
    const { SkyWayContext, SkyWayRoom, SkyWayStreamFactory } = SkyWayRoom;
    const API_KEY = '1bb9fbdb-aa26-4350-a40e-7cc6429e1838';
    let localStream, dataMember, roomInstance;

    function pressKey(num) {
        const input = document.getElementById('sms-view').style.display === 'block' 
            ? document.getElementById('sms-input') 
            : document.getElementById('room-name');
        
        if (num === '*') {
            if(document.getElementById('sms-view').style.display === 'block') sendSMS();
            return;
        }
        input.value += num;
    }

    function toggleSMS() {
        const home = document.getElementById('home-ui');
        const sms = document.getElementById('sms-view');
        if (sms.style.display === 'none') {
            sms.style.display = 'block'; home.style.display = 'none';
        } else {
            sms.style.display = 'none'; home.style.display = 'block';
        }
    }

    async function start() {
        document.getElementById('my-id').innerText = Math.floor(Math.random() * 100);
        try {
            localStream = await SkyWayStreamFactory.createMicrophoneAudioStream();
            document.getElementById('status').innerText = "ğŸ“¶ åœå¤– (ï¾ï½²ï½¸æº–å‚™OK)";

            document.getElementById('make-call').onclick = async () => {
                const roomName = document.getElementById('room-name').value;
                if(!roomName) return alert("åˆè¨€è‘‰ã‚’å…¥åŠ›ã—ã¦ã­");

                document.getElementById('status').innerText = "â˜ ç™ºä¿¡ä¸­...";
                const context = await SkyWayContext.Create(API_KEY, { auth: { type: 'none' } });
                roomInstance = await SkyWayRoom.FindOrCreate(context, { type: 'p2p', name: roomName });
                const me = await roomInstance.join();
                dataMember = me; // SMSç”¨
                await me.publish(localStream);

                roomInstance.onStreamPublished.add(async ({ stream }) => {
                    if (stream.contentType === 'audio') {
                        const { track } = await me.subscribe(stream.id);
                        track.attach(document.getElementById('remote-audio'));
                        document.getElementById('calling-ui').style.display = 'block';
                        document.getElementById('home-ui').style.display = 'none';
                        document.getElementById('status').innerText = "ğŸ“¶ é€šè©±ä¸­";
                        startTimer();
                    }
                });
            };
        } catch (e) { document.getElementById('status').innerText = "âš ï¸ ï¾ï½²ï½¸è¨±å¯ãŒå¿…è¦"; }
    }

    async function sendSMS() {
        const text = document.getElementById('sms-input').value;
        if(!text || !dataMember) return alert("æ¥ç¶šå¾Œã«é€ä¿¡ã—ã¦ã­");
        // æœ¬æ¥ã¯DataStreamã‚’ä½¿ã„ã¾ã™ãŒã€ä»Šå›ã¯ç°¡æ˜“çš„ã«ãƒ­ã‚°è¡¨ç¤ºã®ã¿å®Ÿè£…
        const log = document.getElementById('msg-log');
        log.innerText = "é€ä¿¡æ¸ˆ: " + text;
        document.getElementById('sms-input').value = "";
    }

    function startTimer() {
        let sec = 0;
        setInterval(() => {
            sec++;
            let m = Math.floor(sec / 60).toString().padStart(2, '0');
            let s = (sec % 60).toString().padStart(2, '0');
            document.getElementById('timer').innerText = `${m}:${s}`;
        }, 1000);
    }
    start();
</script>
</body>
</html>
