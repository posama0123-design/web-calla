<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çˆ†é€Ÿé€šè©±ã‚¢ãƒ—ãƒª</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #0f172a; color: #fff; padding: 20px; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; }
        .card { background: #1e293b; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); width: 100%; max-width: 350px; }
        .id-badge { background: #334155; padding: 10px; border-radius: 10px; margin: 15px 0; font-size: 1.2rem; color: #38bdf8; font-weight: bold; }
        input { width: 80%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; text-align: center; }
        button { width: 85%; padding: 12px; margin-top: 10px; border-radius: 8px; border: none; background: #3b82f6; color: white; font-weight: bold; cursor: pointer; }
        button:hover { background: #2563eb; }
        #status { margin-top: 20px; font-size: 0.8rem; color: #94a3b8; }
    </style>
</head>
<body>

    <div class="card">
        <h2>ğŸ™ é€šè©±ãƒ«ãƒ¼ãƒ </h2>
        <p>ã‚ãªãŸã®ID</p>
        <div id="my-id" class="id-badge">èª­è¾¼ä¸­...</div>
        
        <input type="text" id="room-name" placeholder="åˆè¨€è‘‰ã‚’æ±ºã‚ã¦å…¥åŠ›">
        <button id="make-call">é€šè©±ã‚’é–‹å§‹ã™ã‚‹</button>
        
        <div id="status">ãƒã‚¤ã‚¯ã‚’è¨±å¯ã—ã¦ãã ã•ã„</div>
        <audio id="remote-audio" autoplay></audio>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@skyway-sdk/room/dist/skyway_room.js"></script>
    <script>
        const { SkyWayContext, SkyWayRoom, SkyWayStreamFactory } = SkyWayRoom;

        // ã‚ãªãŸã®IDã¨ã€Œèªè¨¼ãªã—ã€è¨­å®šã‚’çµ„ã¿è¾¼ã¿æ¸ˆã¿
        const API_KEY = '1bb9fbdb-aa26-4350-a40e-7cc6429e1838'; 

        async function start() {
            // ãƒ©ãƒ³ãƒ€ãƒ ãªIDã‚’è¡¨ç¤º
            const myId = Math.floor(Math.random() * 100);
            document.getElementById('my-id').innerText = myId;

            try {
                // ãƒã‚¤ã‚¯ã®æº–å‚™
                const audioStream = await SkyWayStreamFactory.createMicrophoneAudioStream();
                document.getElementById('status').innerText = "æº–å‚™å®Œäº†ï¼åˆè¨€è‘‰ã‚’å…¥ã‚Œã¦ã­";

                document.getElementById('make-call').onclick = async () => {
                    const roomName = document.getElementById('room-name').value;
                    if(!roomName) return alert("äºŒäººã§åŒã˜åˆè¨€è‘‰ã‚’å…¥ã‚Œã¦ã­ï¼");

                    document.getElementById('status').innerText = "æ¥ç¶šä¸­...";

                    // ã“ã“ãŒé‡è¦ï¼auth: { type: 'none' } ã‚’è¿½åŠ ã—ã¾ã—ãŸ
                    const context = await SkyWayContext.Create(API_KEY, {
                        auth: { type: 'none' }
                    });

                    const room = await SkyWayRoom.FindOrCreate(context, { type: 'p2p', name: roomName });
                    const me = await room.join();
                    
                    await me.publish(audioStream);

                    room.onStreamPublished.add(async ({ stream }) => {
                        if (stream.contentType === 'audio') {
                            const { track } = await me.subscribe(stream.id);
                            track.attach(document.getElementById('remote-audio'));
                            document.getElementById('status').innerText = "é€šè©±ä¸­ï¼å£°ã¯èã“ãˆã‚‹ã‹ãªï¼Ÿ";
                        }
                    });
                };
            } catch (e) {
                document.getElementById('status').innerText = "ã‚¨ãƒ©ãƒ¼ï¼šãƒã‚¤ã‚¯ã‚’è¨±å¯ã—ã¦ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã­";
                console.error(e);
            }
        }
        start();
    </script>
</body>
</html>
