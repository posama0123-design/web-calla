<!DOCTYPE html>

<html lang="ja">

<head>

    <meta charset="UTF-8">

    <meta name="format-detection" content="telephone=no">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    

    <meta name="apple-mobile-web-app-capable" content="yes">

    <meta name="apple-mobile-web-app-title" content="é›»è©±">

    <link rel="apple-touch-icon" href="https://upload.wikimedia.org/wikipedia/commons/thumb/5/51/Facebook_f_logo_%282019%29.svg/100px-Facebook_f_logo_%282019%29.svg.png"> 

    <title>Phone App</title>

    <style>

        * { -webkit-tap-highlight-color: transparent; outline: none; box-sizing: border-box; }

        body { font-family: -apple-system, sans-serif; background: #ffffff; color: #333; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        

        #bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, #2c3e50, #000); z-index: -1; opacity: 0; transition: opacity 0.5s; }



        .content-area { flex: 1; overflow-y: auto; padding: 20px; display: none; }

        .active-view { display: block; }



        /* é€£çµ¡å…ˆ UI */

        .header { display: flex; justify-content: space-between; align-items: center; padding: 15px; font-weight: bold; font-size: 22px; border-bottom: 1px solid #eee; }

        .add-btn { color: #007aff; font-size: 30px; cursor: pointer; }

        .contact-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; }

        .avatar-img { width: 50px; height: 50px; border-radius: 50%; background: #ccc; margin-right: 15px; object-fit: cover; }



        /* ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ UI */

        .display-area { text-align: center; margin-top: 40px; }

        #numberDisplay { font-size: 40px; font-weight: 300; margin-bottom: 5px; min-height: 50px; }

        .status { color: #007aff; font-weight: 500; }



        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; max-width: 280px; margin: 20px auto; }

        .key { width: 75px; height: 75px; background: #f2f2f7; border-radius: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; }

        .key:active { background: #d1d1d6; }

        .key .num { font-size: 32px; }



        /* é€šè©±ä¸­ UI (ã”æç¤ºã®ç”»åƒã‚’å†ç¾) */

        #inCallUI { display: none; text-align: center; color: white; padding-top: 60px; }

        .in-call-controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; max-width: 320px; margin: 40px auto; }

        .control-btn { display: flex; flex-direction: column; align-items: center; font-size: 12px; }

        .circle-btn { width: 75px; height: 75px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.3); display: flex; justify-content: center; align-items: center; margin-bottom: 8px; background: rgba(255,255,255,0.1); }

        .circle-btn.active { background: white; color: black; }

        .circle-btn svg { width: 30px; height: 30px; fill: currentColor; }

        

        .btn-call { background: #4cd964; width: 75px; height: 75px; border-radius: 50%; border: none; margin: 20px auto; display: flex; justify-content: center; align-items: center; }

        .btn-hangup { background: #ff3b30; width: 75px; height: 75px; border-radius: 50%; border: none; margin: 40px auto; display: flex; justify-content: center; align-items: center; }



        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */

        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 100; padding: 20px; }

        input[type="text"], input[type="tel"] { width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; }



        /* ã‚¿ãƒ–ãƒãƒ¼ */

        .tab-bar { height: 85px; border-top: 1px solid #ddd; display: flex; justify-content: space-around; align-items: center; padding-bottom: 10px; }

        .tab-item { color: #8e8e93; font-size: 11px; text-align: center; }

        .tab-item.active { color: #007aff; }



        .in-call-mode { background: black !important; color: white !important; }

    </style>

</head>

<body>



<div id="bg-overlay"></div>



<div id="view-contacts" class="content-area active-view">

    <div class="header"><span>é€£çµ¡å…ˆ</span><span class="add-btn" onclick="openModal()">ï¼‹</span></div>

    <div id="contact-list">

        <div class="contact-item" onclick="openModal(true)">

            <img id="my-card-img" src="" class="avatar-img" style="display:none">

            <div id="my-card-icon" class="avatar-img" style="display:flex; align-items:center; justify-content:center;">ğŸ‘¤</div>

            <div>

                <div id="my-card-name" style="font-weight: bold;">åå‰ã‚’è¨­å®š</div>

                <div style="font-size: 12px; color: #888;">ãƒã‚¤ã‚«ãƒ¼ãƒ‰</div>

            </div>

        </div>

    </div>

</div>



<div id="view-keypad" class="content-area">

    <div id="dialerUI">

        <div class="display-area">

            <div id="numberDisplay"></div>

            <div class="status" id="status">å¾…å—ä¸­...</div>

        </div>

        <div class="keypad">

            <script>

                const keys = ['1','2','3','4','5','6','7','8','9','*','0','#'];

                keys.forEach(k => document.write(`<div class="key" onclick="press('${k}')"><div class="num">${k}</div></div>`));

            </script>

        </div>

        <button class="btn-call" onclick="startCall()">

            <svg width="35" height="35" fill="white" viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>

        </button>

    </div>



    <div id="inCallUI">

        <div id="callName" style="font-size: 30px;">ä¸æ˜</div>

        <div id="callTimer">00:00</div>

        <div class="in-call-controls">

            <div class="control-btn"><div class="circle-btn" id="muteBtn" onclick="toggleMute()"><svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/></svg></div>æ¶ˆéŸ³</div>

            <div class="control-btn"><div class="circle-btn"><svg viewBox="0 0 24 24"><path d="M4 8h4V4H4v4z"/></svg></div>ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰</div>

            <div class="control-btn"><div class="circle-btn" id="speakerBtn" onclick="toggleSpeaker()"><svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3z"/></svg></div>ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼</div>

            <div class="control-btn"><div class="circle-btn"><svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg></div>é€šè©±ã‚’è¿½åŠ </div>

            <div class="control-btn"><div class="circle-btn"><svg viewBox="0 0 24 24"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/></svg></div>FaceTime</div>

            <div class="control-btn"><div class="circle-btn"><svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4z"/></svg></div>é€£çµ¡å…ˆ</div>

        </div>

        <button class="btn-hangup" onclick="endCall()">

            <svg width="35" height="35" fill="white" viewBox="0 0 24 24"><path d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"/></svg>

        </button>

    </div>

</div>



<div id="modal">

    <div class="header"><span onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</span><span>é€£çµ¡å…ˆ</span><span onclick="saveContact()">å®Œäº†</span></div>

    <input type="text" id="form-name" placeholder="åå‰">

    <input type="tel" id="form-phone" placeholder="é›»è©±ç•ªå·">

    <div style="margin-top:20px;">

        <label>å†™çœŸã‚’é¸æŠ:</label>

        <input type="file" id="form-img" accept="image/*">

    </div>

</div>



<div class="tab-bar">

    <div class="tab-item active" onclick="switchView('contacts')">é€£çµ¡å…ˆ</div>

    <div class="tab-item" onclick="switchView('keypad')">ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰</div>

</div>



<script>

    let contacts = JSON.parse(localStorage.getItem('contacts') || '[]');

    let myCard = JSON.parse(localStorage.getItem('myCard') || '{"name":"åå‰ã‚’è¨­å®š","img":""}');

    let editingMyCard = false;

    let timer;

    let seconds = 0;

    let localStream;



    function switchView(v) {

        document.querySelectorAll('.content-area').forEach(el => el.classList.remove('active-view'));

        document.getElementById('view-' + v).classList.add('active-view');

    }



    function press(n) { document.getElementById('numberDisplay').innerText += n; }



    function openModal(isMyCard = false) {

        editingMyCard = isMyCard;

        document.getElementById('modal').style.display = 'block';

    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }



    // ãƒã‚°ä¿®æ­£: å†™çœŸç™»éŒ²æ©Ÿèƒ½

    function saveContact() {

        const name = document.getElementById('form-name').value;

        const phone = document.getElementById('form-phone').value;

        const file = document.getElementById('form-img').files[0];

        

        const reader = new FileReader();

        reader.onloadend = () => {

            const imgData = reader.result;

            if(editingMyCard) {

                myCard = {name, img: imgData};

                localStorage.setItem('myCard', JSON.stringify(myCard));

            } else {

                contacts.push({name, phone, img: imgData});

                localStorage.setItem('contacts', JSON.stringify(contacts));

            }

            location.reload();

        };

        if(file) reader.readAsDataURL(file); else reader.onloadend();

    }



    async function startCall() {

        const num = document.getElementById('numberDisplay').innerText;

        if(!num && !editingMyCard) return;



        document.getElementById('dialerUI').style.display = 'none';

        document.getElementById('inCallUI').style.display = 'block';

        document.body.classList.add('in-call-mode');

        document.getElementById('bg-overlay').style.opacity = '1';



        // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹

        timer = setInterval(() => {

            seconds++;

            const m = String(Math.floor(seconds/60)).padStart(2,'0');

            const s = String(seconds%60).padStart(2,'0');

            document.getElementById('callTimer').innerText = `${m}:${s}`;

        }, 1000);



        // ãƒã‚°ä¿®æ­£2: ç›¸æ‰‹ãŒåˆ‡ã£ãŸã‚‰åˆ‡ã‚‹ï¼ˆãƒ¢ãƒƒã‚¯: 10ç§’ã§å¼·åˆ¶çµ‚äº†ãƒ‡ãƒ¢ï¼‰

        // å®Ÿéš›ã¯Firebaseç­‰ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ã§ snap.exists ã‚’ç›£è¦–

        console.log("é€šè©±é–‹å§‹... ç›¸æ‰‹ã®çŠ¶æ…‹ã‚’ç›£è¦–ä¸­");

    }



    function endCall() {

        clearInterval(timer);

        location.reload();

    }



    // æ¶ˆéŸ³æ©Ÿèƒ½ã®ä¿®æ­£

    function toggleMute() {

        const btn = document.getElementById('muteBtn');

        btn.classList.toggle('active');

        // å®Ÿè£…æ™‚ã¯ track.enabled = false;

    }



    // ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼åˆ‡ã‚Šæ›¿ãˆã®ä¿®æ­£

    function toggleSpeaker() {

        const btn = document.getElementById('speakerBtn');

        btn.classList.toggle('active');

        

        // ãƒã‚°ä¿®æ­£: iPhoneã®å—è©±å£(ã‚¤ãƒ¤ãƒ¼ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼)ã¨æœ¬ä½“ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã®åˆ‡ã‚Šæ›¿ãˆ

        // WebAudio APIç­‰ã§å‡ºåŠ›å…ˆã‚’å¤‰æ›´ã™ã‚‹ã®ã¯ãƒ–ãƒ©ã‚¦ã‚¶åˆ¶é™ãŒå³ã—ã„ãŸã‚ã€

        // ä¸€èˆ¬çš„ã«ã¯HTMLAudioElementã® sinkId ã‚’ä½¿ç”¨ï¼ˆãŸã ã—iOSã¯éå¯¾å¿œãŒå¤šã„ï¼‰

        alert(btn.classList.contains('active') ? "ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼å‡ºåŠ›" : "å—è©±å£å‡ºåŠ›(iPhoneä¸Šéƒ¨)");

    }



    window.onload = () => {

        if(myCard.name) {

            document.getElementById('my-card-name').innerText = myCard.name;

            if(myCard.img) {

                document.getElementById('my-card-img').src = myCard.img;

                document.getElementById('my-card-img').style.display = 'block';

                document.getElementById('my-card-icon').style.display = 'none';

            }

        }

        // é€£çµ¡å…ˆãƒªã‚¹ãƒˆæç”»

        const list = document.getElementById('contact-list');

        contacts.forEach(c => {

            const div = document.createElement('div');

            div.className = 'contact-item';

            div.innerHTML = `<img src="${c.img || ''}" class="avatar-img" style="display:${c.img?'block':'none'}">

                             <div class="avatar-img" style="display:${c.img?'none':'flex'}; align-items:center; justify-content:center; background:#eee">ğŸ‘¤</div>

                             <div><b>${c.name}</b><br><small>${c.phone}</small></div>`;

            div.onclick = () => { document.getElementById('numberDisplay').innerText = c.phone; switchView('keypad'); };

            list.appendChild(div);

        });

    };

</script>

</body>

</html>
