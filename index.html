<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚¬ãƒ©ã‚±ãƒ¼ - SO Real-Call</title>
    <style>
        :root { --lcd-bg: #c2c7ba; --lcd-text: #333; }
        body { background: #1a1a1a; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; font-family: sans-serif; }
        .phone { width: 320px; background: linear-gradient(145deg, #ddd, #888); border-radius: 30px; padding: 25px; border: 4px solid #555; box-shadow: 0 20px 50px rgba(0,0,0,0.8); }
        
        /* æ¶²æ™¶ç”»é¢ */
        .screen { background: var(--lcd-bg); height: 260px; border: 12px solid #111; display: flex; flex-direction: column; color: var(--lcd-text); position: relative; overflow: hidden; border-radius: 5px; }
        .status-bar { font-size: 11px; display: flex; justify-content: space-between; padding: 2px 5px; border-bottom: 1px solid rgba(0,0,0,0.2); }
        
        .menu-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 10px; flex: 1; }
        .menu-item { text-align: center; font-size: 11px; padding: 2px; }
        .menu-item.selected { background-color: #555; color: #fff; }

        .app-layer { position: absolute; top: 18px; left: 0; width: 100%; height: calc(100% - 18px); background: var(--lcd-bg); display: none; flex-direction: column; padding: 10px; box-sizing: border-box; z-index: 10; text-align: center; }
        #dialDisplay { font-size: 24px; margin-top: 20px; letter-spacing: 2px; height: 30px; }

        /* ç‰¹å¾´çš„ãªæ“ä½œãƒœã‚¿ãƒ³ */
        .nav-section { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin: 20px 0; align-items: center; }
        
        .call-btn { 
            background: linear-gradient(#4caf50, #2e7d32); color: white; border: 2px solid #1b5e20; 
            border-radius: 10px; height: 40px; font-weight: bold; cursor: pointer; box-shadow: 0 3px #154718;
        }
        .call-btn:active { transform: translateY(2px); box-shadow: 0 1px #154718; }

        .end-btn { 
            background: linear-gradient(#f44336, #c62828); color: white; border: 2px solid #b71c1c; 
            border-radius: 10px; height: 40px; font-weight: bold; cursor: pointer; box-shadow: 0 3px #7f0000;
        }
        .end-btn:active { transform: translateY(2px); box-shadow: 0 1px #7f0000; }

        .ok-btn { width: 55px; height: 55px; border-radius: 50%; background: radial-gradient(#666, #222); color: white; border: 3px solid #888; cursor: pointer; font-size: 14px; box-shadow: 0 4px #000; }

        /* ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ */
        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .keypad button { background: #eee; border: 1px solid #999; padding: 12px; border-radius: 8px; cursor: pointer; border-bottom: 4px solid #bbb; }
        .key-num { font-size: 18px; font-weight: bold; display: block; }
        .key-sub { font-size: 9px; color: #666; }

        /* ç€ä¿¡ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0; } }
        .incoming { color: #d00; font-weight: bold; animation: blink 0.5s infinite; font-size: 20px; }
    </style>
</head>
<body>

<div class="phone">
    <div class="screen">
        <div class="status-bar"><span>ğŸ“¶ *Yll</span><span id="clock">12:00</span><span>ğŸ”‹</span></div>
        
        <div class="menu-grid" id="homeMenu">
            <div class="menu-item selected" id="menu-0"><span style="font-size:20px; display:block;">ğŸ“–</span>ã‚¢ãƒ‰ãƒ¬ã‚¹å¸³</div>
            <div class="menu-item" id="menu-1"><span style="font-size:20px; display:block;">ğŸ“</span>é›»è©±</div>
            <div class="menu-item" id="menu-2"><span style="font-size:20px; display:block;">ğŸ“</span>ãƒ¡ãƒ¢</div>
        </div>

        <div class="app-layer" id="appScreen">
            <div id="appTitle" style="font-weight:bold; border-bottom:1px solid #000; margin-bottom:10px;"></div>
            <div id="appContent"></div>
        </div>
    </div>

    <div class="nav-section">
        <button class="call-btn" onclick="startCall()">é€šè©±</button>
        <button class="ok-btn" onclick="openApp()">æ±ºå®š</button>
        <button class="end-btn" onclick="closeApp()">çµ‚äº†</button>
    </div>

    <div class="keypad">
        <button onclick="press('1')"><span class="key-num">1</span><span class="key-sub">ã‚</span></button>
        <button onclick="press('2')"><span class="key-num">2</span><span class="key-sub">ã‹</span></button>
        <button onclick="press('3')"><span class="key-num">3</span><span class="key-sub">ã•</span></button>
        <button onclick="press('4')"><span class="key-num">4</span><span class="key-sub">ãŸ</span></button>
        <button onclick="press('5')"><span class="key-num">5</span><span class="key-sub">ãª</span></button>
        <button onclick="press('6')"><span class="key-num">6</span><span class="key-sub">ã¯</span></button>
        <button onclick="press('7')"><span class="key-num">7</span><span class="key-num">7</span><span class="key-sub">ã¾</span></button>
        <button onclick="press('8')"><span class="key-num">8</span><span class="key-sub">ã‚„</span></button>
        <button onclick="press('9')"><span class="key-num">9</span><span class="key-sub">ã‚‰</span></button>
        <button onclick="press('*')"><span class="key-num">ï¼Š</span><span class="key-sub">å¤§å°</span></button>
        <button onclick="press('0')"><span class="key-num">0</span><span class="key-sub">ã‚ã‚’ã‚“</span></button>
        <button onclick="press('#')"><span class="key-num">ï¼ƒ</span><span class="key-sub">æ¶ˆå»</span></button>
    </div>
</div>

<script>
    let selectedIndex = 1; // æœ€åˆã‹ã‚‰é›»è©±ã«åˆã‚ã›ã‚‹
    let isAppOpen = false;
    let dialNumber = "";
    let audioCtx = null;

    // é€šè©±ãƒ™ãƒ«ã‚’é³´ã‚‰ã™é–¢æ•°
    function playBell() {
        if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let osc = audioCtx.createOscillator();
        let gain = audioCtx.createGain();
        osc.type = 'square';
        osc.frequency.setValueAtTime(880, audioCtx.currentTime);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 1);
        osc.stop(audioCtx.currentTime + 1);
    }

    // ä»–ã®ã‚¿ãƒ–ã‹ã‚‰ã®ç€ä¿¡ã‚’ç›£è¦–
    window.addEventListener('storage', (e) => {
        if (e.key === 'incoming_call' && e.newValue === '5555') {
            receiveCall();
        }
    });

    function receiveCall() {
        isAppOpen = true;
        const app = document.getElementById('appScreen');
        app.style.display = 'flex';
        document.getElementById('appTitle').innerText = "ç€ä¿¡ä¸­";
        document.getElementById('appContent').innerHTML = "<div class='incoming'>ğŸ”” ç€ä¿¡ä¸­ ğŸ””<br>5555</div>";
        let bellTimer = setInterval(() => {
            if(!isAppOpen) clearInterval(bellTimer);
            else playBell();
        }, 1500);
    }

    function startCall() {
        if (isAppOpen && selectedIndex === 1 && dialNumber === "5555") {
            document.getElementById('appContent').innerHTML = "ç™ºä¿¡ä¸­...<br>5555";
            // ä»–ã®ã‚¿ãƒ–ã¸ã€Œ5555ã€ã‹ã‚‰é›»è©±ã—ãŸã“ã¨ã‚’é€šçŸ¥
            localStorage.setItem('incoming_call', ''); 
            localStorage.setItem('incoming_call', '5555');
        } else {
            openApp();
        }
    }

    function openApp() {
        isAppOpen = true;
        document.getElementById('appScreen').style.display = 'flex';
        const title = document.getElementById('appTitle');
        const content = document.getElementById('appContent');
        
        if (selectedIndex === 1) {
            title.innerText = "é›»è©±ç•ªå·å…¥åŠ›";
            content.innerHTML = "<div id='dialDisplay'></div>";
            dialNumber = "";
        } else if (selectedIndex === 2) {
            title.innerText = "ãƒ¡ãƒ¢å¸³";
            content.innerHTML = `<textarea id="memoText" style="width:100%;height:150px;background:transparent;border:none;">${localStorage.getItem('keita_memo')||''}</textarea>`;
        } else {
            title.innerText = "ã‚¢ãƒ‰ãƒ¬ã‚¹å¸³";
            content.innerHTML = "ï¼ˆç™»éŒ²ãªã—ï¼‰";
        }
    }

    function closeApp() {
        if (selectedIndex === 2 && isAppOpen) {
            localStorage.setItem('keita_memo', document.getElementById('memoText').value);
        }
        isAppOpen = false;
        dialNumber = "";
        document.getElementById('appScreen').style.display = 'none';
        localStorage.removeItem('incoming_call');
    }

    function press(k) {
        if (!isAppOpen) return;
        if (selectedIndex === 1) { // é›»è©±å…¥åŠ›
            if (k === '#') dialNumber = dialNumber.slice(0, -1);
            else if (k !== '*') dialNumber += k;
            document.getElementById('dialDisplay').innerText = dialNumber;
        }
    }

    function updateClock() {
        const n = new Date();
        document.getElementById('clock').innerText = n.getHours().toString().padStart(2,'0')+":"+n.getMinutes().toString().padStart(2,'0');
    }
    setInterval(updateClock, 1000); updateClock();
</script>
</body>
</html>
