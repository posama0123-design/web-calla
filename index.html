<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒ–ãƒ©ã‚¦ã‚¶éŸ³å£°é€šè©±ï¼ˆç¢ºå®Ÿãƒ»æ‰‹å‹•æ¥ç¶šç‰ˆï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: sans-serif; background:#0f172a; color:#e5e7eb; padding:20px }
    .card { max-width:480px; margin:auto; background:#020617; padding:16px; border-radius:16px }
    textarea, input, button { width:100%; padding:10px; margin-top:8px; border-radius:10px; border:none }
    button { background:#38bdf8; color:#020617; cursor:pointer }
    .danger { background:#fb7185 }
    video { width:100%; margin-top:10px; background:#000; border-radius:12px }
    .note { font-size:0.85rem; opacity:0.85 }
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸ§ ãƒ–ãƒ©ã‚¦ã‚¶éŸ³å£°é€šè©±ï¼ˆç¢ºå®Ÿã«å‹•ãç‰ˆï¼‰</h2>
    <p class="note">â€» ã“ã®æ–¹å¼ã¯ã€Œå¿…ãšéŸ³ãŒå‡ºã‚‹ã€ç¢ºèªç”¨ã§ã™</p>

    <button onclick="createOffer()">â‘  ç™ºä¿¡å´ï¼šã‚ªãƒ•ã‚¡ãƒ¼ä½œæˆ</button>
    <textarea id="offer" placeholder="ã“ã“ã«ã‚ªãƒ•ã‚¡ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™"></textarea>

    <textarea id="answer" placeholder="ç›¸æ‰‹ã‹ã‚‰å—ã‘å–ã£ãŸã‚¢ãƒ³ã‚µãƒ¼ã‚’è²¼ã‚Šä»˜ã‘"></textarea>
    <button onclick="setAnswer()">â‘¡ ç™ºä¿¡å´ï¼šã‚¢ãƒ³ã‚µãƒ¼ã‚’è¨­å®š</button>

    <hr style="margin:12px 0; opacity:0.3" />

    <textarea id="remoteOffer" placeholder="ç™ºä¿¡å´ã‹ã‚‰å—ã‘å–ã£ãŸã‚ªãƒ•ã‚¡ãƒ¼ã‚’è²¼ã‚Šä»˜ã‘"></textarea>
    <button onclick="createAnswer()">â‘¢ å—ä¿¡å´ï¼šã‚¢ãƒ³ã‚µãƒ¼ä½œæˆ</button>
    <textarea id="localAnswer" placeholder="ã“ã“ã«ã‚¢ãƒ³ã‚µãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™"></textarea>

    <button class="danger" onclick="endCall()">é€šè©±ã‚’åˆ‡ã‚‹</button>

    <video id="remote" autoplay playsinline></video>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/simple-peer@9/simplepeer.min.js"></script>

  <script>
    let peer;
    let stream;

    async function getStream() {
      if (!stream) {
        stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });
      }
      return stream;
    }

    async function createOffer() {
      await getStream();
      peer = new SimplePeer({ initiator: true, trickle: false, stream });

      peer.on('signal', data => {
        document.getElementById('offer').value = JSON.stringify(data);
      });

      peer.on('stream', s => {
        document.getElementById('remote').srcObject = s;
      });
    }

    async function createAnswer() {
      await getStream();
      peer = new SimplePeer({ initiator: false, trickle: false, stream });

      const offer = JSON.parse(document.getElementById('remoteOffer').value);
      peer.signal(offer);

      peer.on('signal', data => {
        document.getElementById('localAnswer').value = JSON.stringify(data);
      });

      peer.on('stream', s => {
        document.getElementById('remote').srcObject = s;
      });
    }

    function setAnswer() {
      const answer = JSON.parse(document.getElementById('answer').value);
      peer.signal(answer);
    }

    function endCall() {
      if (peer) peer.destroy();
      peer = null;
      document.getElementById('remote').srcObject = null;
    }
  </script>
</body>
</html>
